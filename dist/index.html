<!DOCTYPE html>
<html lang="ko" style="height: 100%; display: block">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, minimal-ui, initial-scale=1.0,maximum-scale=1.0, user-scalable=no, viewport-fit=cover" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel = "apple-touch-icon" href="jrnaver_192X192.png">
    <meta name="full-screen" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="./manifest.json">
    <meta property="og:title" content="해저 탐험">
    <meta property="og:image" content="jrnaver_192X192.png">
    <title>해저 탐험</title>

    <style >
        body{
            margin: 0;
            padding: 0;
            height: 100%;
            display: block;
            background-color: #ffcc00;
            overflow:hidden;
        }

        #loading {
            position: absolute;
            margin: 0;
            padding: 0;
            /*background-image: url("./asset/game/image/preLoadingBg.png");*/
            /*background-repeat: no-repeat;*/
            /*background-size: contain;*/
            color: white;
            text-align: center;
            vertical-align:top;
        }

    </style>
</head>
<body scroll="no">
<div id="loading"></div>
<canvas id="glcanvas" width="10" height="10"></canvas>


<script>

    function checkBr(){
        /**
         * PC 브라우저 지원 하지 않을 경우
         * IE 8 이하 일 경우
         */
        let canvas = document.getElementById("glcanvas");
        if(isMobile())
        {
            if(!canvas) return false;
            let gl = initWebGL(canvas);      // Initialize the GL context
            document.body.removeChild(canvas);

            if (gl) {
                return true;
            }else{
                return false;
            }
        }else{
            if(!canvas) return false;
            document.body.removeChild(canvas);
            if(navigator.appName.toLocaleLowerCase() == "microsoft internet explorer") {
                if(navigator.userAgent.indexOf("MSIE 10.0") == -1) {
                    if(navigator.userAgent.indexOf("MSIE 9.0") == -1) {
                        // console.log("지원 X");
                        return false
                    }
                }
            }
        }
        return true;
    }

    function isMobile() {
        let filter = "win16|win32|win64|mac|macintel";
        if( navigator.platform  ){
            if( filter.indexOf(navigator.platform.toLowerCase())<0 ){
                return true;
            }else{
                return false;
            }
        }
    }


    function initWebGL(canvas) {
        let gl = null;
        try {
            gl = canvas.getContext("webgl") || canvas.getContext("experimental-webgl");
        }
        catch(e) {}
        // If we don't have a GL context, give up now
        if (!gl) {
            gl = null;
        }
        return gl;
    }


    function changeWinSize() {

        let ww = document.body.clientWidth;
        let wh = document.body.clientHeight;

        // let ww = window.innerWidth;
        // let wh = window.innerHeight;

        let _loading = document.getElementById('loading');

        let cw = 1280;
        let ch = 720;

        let scaleX = ww / cw;
        let scaleY = wh / ch;


        let scale;
        if (scaleX > scaleY) {
            scale = scaleY
        } else {
            scale = scaleX
        }

        if(_loading) {
           let ah = Math.round(ch * scale);
           let aw = Math.round(cw * scale);

            _loading.style.width = aw + 'px';
            _loading.style.height = ah + 'px';

            let leftGap = Math.round((ww - aw) / 2);
            let topGap = Math.round((wh - ah) / 2);

            _loading.style.left = leftGap + 'px';
            _loading.style.top = topGap + 'px';
        }
    }

    function full_screen()
    {
        if("fullscreenEnabled" in document || "webkitFullscreenEnabled" in document || "mozFullScreenEnabled" in document || "msFullscreenEnabled" in document)
        {
            if(document.fullscreenEnabled || document.webkitFullscreenEnabled || document.mozFullScreenEnabled || document.msFullscreenEnabled)
            {
                // console.log("User allows fullscreen");

                let element = document.body
                if("requestFullscreen" in element)
                {
                    element.requestFullscreen();
                }
                else if ("webkitRequestFullscreen" in element)
                {
                    element.webkitRequestFullscreen();
                }
                else if ("mozRequestFullScreen" in element)
                {
                    element.mozRequestFullScreen();
                }
                else if ("msRequestFullscreen" in element)
                {
                    element.msRequestFullscreen();
                }
            }

            // console.log("full_screen")
        }
        else
        {
            // console.log("User doesn't allow full screen");
        }
    }


    function screen_change()
    {
        if(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement)
        {
            // console.log("Current full screen element is : " + (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement))
        }
        else
        {
            if ("exitFullscreen" in document)
            {
                document.exitFullscreen();
            }
            else if ("webkitExitFullscreen" in document)
            {
                document.webkitExitFullscreen();
            }
            else if ("mozCancelFullScreen" in document)
            {
                document.mozCancelFullScreen();
            }
            else if ("msExitFullscreen" in document)
            {
                document.msExitFullscreen();
            }
        }
        // console.log("screen_change");
    }


    function searchParams(url, par){
        let temp = url.split("?");
        if(temp.length > 1){
            let cc = temp[1];
            temp = cc.split("&");
            for(let i = 0 ; i<temp.length ; i++){
                cc = temp[i].split("=");
                if(cc[0] == par){
                    return cc[1];
                }
            }
            return 0;
        }else{
            return 0;
        }
    }


    let flag = checkBr();
    if(flag) {
        document.addEventListener("fullscreenchange", screen_change);
        document.addEventListener("webkitfullscreenchange", screen_change);
        document.addEventListener("mozfullscreenchange", screen_change);
        document.addEventListener("MSFullscreenChange", screen_change);
        document.addEventListener("fullscreenerror", function(){/*console.log("Full screen failed");*/});
        document.addEventListener("webkitfullscreenerror", function(){/*console.log("Full screen failed");*/});
        document.addEventListener("mozfullscreenerror", function(){/*console.log("Full screen failed");*/});
        document.addEventListener("MSFullscreenError", function(){/*console.log("Full screen failed");*/});
        window.addEventListener("resize", function(evt) {
            changeWinSize();
        }, false);
        let url_string = location.href;
        let my_awesome_script = document.createElement('script');
        //my_awesome_script.setAttribute('src','./jr.con.write.abc.min.js?v1.1.0');
        my_awesome_script.setAttribute('src','index.bundle.js');
        document.body.appendChild(my_awesome_script);
        changeWinSize();
    }else{
        changeWinSize();
        let div = document.getElementById('loading');
        div.style.backgroundImage = "url('')";
        div.innerHTML += '<div class="inner">'+
            '<p>해당 컨텐츠를 지원 하지 않는 브라우저 입니다. </p>'+
            '</div>';
    }
</script>

</body>
</html>